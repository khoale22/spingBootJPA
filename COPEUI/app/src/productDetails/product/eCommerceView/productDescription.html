<!--
  ~ productDescription.html
  ~
  ~  Copyright (c) 2017 HEB
  ~  All rights reserved.
  ~
  ~  This software is the confidential and proprietary information
  ~  of HEB.
  ~
  ~	@author vn70529
  ~	@since 2.12.0
  -->
<div class="card card-primary" ng-init="$ctrl.init()">
	<div class="card-header">
		<i class="glyphicon glyphicon-text-background"></i>Product Description
		<span class="glyphicon glyphicon-folder-open pointer" style="float: right; color : blue" ng-click="$ctrl.showeCommerceViewLog()"></span>
	</div>
	<div class="card-body" style="min-height: 100px;">
		<div class="row" ng-show="$ctrl.isWaitingForResponse">
			<loading-spinner></loading-spinner>
		</div>
		<div data-ng-hide="$ctrl.isWaitingForResponse">
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-5 ecom-box-title">
						<div class="col-md-8" style="padding-left: 0px;">
							<div class="pull-left">
								<Label style="{{$ctrl.eCommerceViewDetails.romanceCopy.differentWithDefaultValue?'color:blue;':''}}">Romance
									Copy </Label>
								<div class="btn-group" ng-show="$ctrl.editableRomanceCopy" can-edit="PD_ECOM_01">
									<button type="button" class="btn btn-default active"
											ng-click="$ctrl.showFormatRomanceField(false)"
											button-spell-check="!$ctrl.htmlShow">Text
									</button>
									<button type="button" class="btn btn-default"
											ng-mousedown="$ctrl.htmlTabClick()"
											data-ng-disabled="$ctrl.isWaitingForCheckSpellingResponse"
											ng-click="$ctrl.showFormatRomanceField(true)"
											button-spell-check="$ctrl.htmlShow">HTML
									</button>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<small-loading-spinner ng-show="$ctrl.isWaitingForCheckSpellingResponse">
							</small-loading-spinner>
						</div>
					</div>
					<div class="col-md-7">
						<div class="pull-right">
							<a view-only="PD_ECOM_01" class="pointer margin-right-10 linkDisabled"
							   style="{{$ctrl.eCommerceViewDetails.romanceCopy.differentWithDefaultValue?'color:blue;':''}}font-weight: bold;">
								Edit Text</a>
							<a can-edit="PD_ECOM_01" class="pointer margin-right-10"
							   style="{{$ctrl.eCommerceViewDetails.romanceCopy.differentWithDefaultValue?'color:blue;':''}}font-weight: bold;"
							   data-ng-click="$ctrl.showEditText()">
								Edit Text</a>
							<a class="pointer"
							   style="{{$ctrl.eCommerceViewDetails.romanceCopy.differentWithDefaultValue?'color:blue;':''}}font-weight: bold;"
							   data-ng-click="$ctrl.showDescriptionEditSource()">Edit Source</a>
						</div>
					</div>
				</div>
			</div>
			<div view-only="PD_ECOM_01" style="min-height: 30px;text-align: justify;">
				<div ng-bind-html="$ctrl.romanceCopyContent"></div>
			</div>
			<div can-edit="PD_ECOM_01" class="brandDisplayNameRomancy">
				<div ng-show="!$ctrl.editableRomanceCopy"
					 ng-bind-html="$ctrl.romanceCopyContent"></div>
				<div ng-show="!$ctrl.htmlShow && $ctrl.editableRomanceCopy" id="romanceCopyDiv"
					 spellcheck="false"
					 contenteditable="true"
					 contenteditable-romancy-model
					 style="height: 90px;width: 100%;text-align: justify;resize: vertical; overflow-y: auto;"
					 data-ng-model="$ctrl.eCommerceViewDetails.romanceCopy.content"
					 class="form-control"
					 ng-disabled="$ctrl.isWaitingForCheckSpellingResponse"
					 ng-blur="$ctrl.validateRomancyTextForEdit()"></div>
				<textarea ng-show="$ctrl.htmlShow && $ctrl.editableRomanceCopy"
						  data-ng-model="$ctrl.eCommerceViewDetails.romanceCopy.htmlContent"
						  class="form-control"
						  style="height:90px;resize: vertical;"
						  ng-bind-html="$ctrl.trustAsHtml($ctrl.eCommerceViewDetails.romanceCopy.htmlContent)"></textarea>
				<div data-ng-if="$ctrl.editableRomanceCopy"
					 style="{{$ctrl.MAX_LENGTH_ROMANCE_COPY_DESCRIPTION - $ctrl.eCommerceViewDetails.romanceCopy.content.length > 0?'color: green;':'color: red;'}}">
					Characters Remaining: {{$ctrl.MAX_LENGTH_ROMANCE_COPY_DESCRIPTION -
					$ctrl.eCommerceViewDetails.romanceCopy.content.length}}.
				</div>
			</div>
			<div class="row" style="margin-top: 3%">
				<div class="col-md-12">
					<div class="col-md-5 ecom-box-title"><Label
							style="{{$ctrl.tags.differentWithDefaultValue?'color:blue;':''}}">Tags</Label></div>
					<div class="col-md-7">
						<div class="pull-right">
							<a class="pointer"
							   style="{{$ctrl.tags.differentWithDefaultValue?'color:blue;':''}}font-weight: bold;"
							   data-ng-click="$ctrl.showTagsEditSource()">Edit Source</a>
						</div>
					</div>
				</div>
			</div>
			<div style="min-height: 20px;text-align: justify;">
				<span ng-bind-html="$ctrl.tags.content"></span>
			</div>
		</div>
	</div>
</div>
<div id="editDescriptionSource" class="modal fade" role="dialog" maxlength="500px;">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header" style="background-color: #337ab7">
				<h5 class="modal-title inline-block" style="color: #ffffff">
					Romance Copy
				</h5>
			</div>
			<div class="modal-body">
				<div class="alert alert-danger" data-ng-if="$ctrl.errorPopup">
					{{$ctrl.errorPopup}}
				</div>
				<div class="row">
					<div class="col-md-9">
						<table
							class="table-heb table-bordered table-striped table-fixed" style="width:100%;">
							<thead>
							<tr>
								<th class="col-md-1" style="vertical-align: middle;">Select</th>
								<th class="col-md-2" style="vertical-align: middle;">Source</th>
								<th class="col-md-2" style="vertical-align: middle;">Created Date</th>
								<th class="col-md-7" style="vertical-align: middle;">Value</th>
							</tr>
							</thead>
							<tbody>
							<tr ng-show="!$ctrl.isWaitingForDescriptionSources"
								class="{{$ctrl.selectedRowIndexOnDescriptionSourceTable == $index ? 'row-selected white-text':''}}"
								data-ng-repeat="item in $ctrl.descriptionSources track by $index"
								data-ng-click="$ctrl.selectRowOnDescriptionSource($index)" style="cursor: pointer">
								<td class="col-md-1" style="vertical-align: middle;"></td>
								<td class="col-md-2" style="vertical-align: middle;"> {{item.source}}</td>
								<td class="col-md-2" style="vertical-align: middle;">
									{{item.createdDate | date : 'MM/dd/yyyy'}}
								</td>
								<td class="col-md-7" style="vertical-align: middle;">
									{{item.content}}
								</td>
							</tr>
							<tr ng-show="$ctrl.isWaitingForDescriptionSources">
								<td colspan="4">
									<loading-spinner></loading-spinner>
								</td>
							</tr>
							</tbody>
						</table>
						<div class="inline-block pull-right" style="margin-top: 20px;margin-bottom: 10px;">
							<button class="btn btn-primary"
									data-ng-click="$ctrl.selectForHEB()">Select for HEB.com
							</button>
							<button class="btn btn-primary"
									data-ng-click="$ctrl.resetEditDescriptionSource()">Reset
							</button>
							<button class="btn btn-primary" data-ng-click="$ctrl.cancelEditDescriptionSource()"
							>Cancel
							</button>
						</div>
					</div>
					<div class="col-md-3">
						<div class="text-center">HEB.com</div>
						<div class="margin-top-10"><label>Posted Date</label></div>
						<div class="margin-top-10">{{$ctrl.productDescription.content | date : 'MM/dd/yyyy'}}</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="ecommerce-view-log">
	<div id="ecommerce-view-log-modal" class="modal fade">
		<div class="modal-dialog" style="min-width: 800px;">
			<div class="modal-content">
				<div class="modal-header" style="background-color: #337ab7">
					<h5 class="modal-title" style="color: #ffffff">eCommerce View: Change log</h5>
				</div>
				<div class="modal-body">
					<div style="margin-bottom: 20px; margin-top: -5px; font-size: 12px;">Product ID <b>{{$ctrl.productMaster.prodId}}</b> Product Description <b>{{$ctrl.productMaster.description}}</b></div>
					<div class="row" ng-show="$ctrl.isWaitingGetECommerceViewAudit">
						<loading-spinner></loading-spinner>
					</div>
					<div class="ecommerce-view-log-table" ng-show="!$ctrl.isWaitingGetECommerceViewAudit">
						<table ng-table="eCommerceViewAuditTableParams" show-filter="true" class="table-heb table-bordered table-striped margin-top-10" style="width: 100%;">
							<thead>
							<tr style="min-height:25px">
								<th style="width:15%; vertical-align: middle; padding-top: 6px; padding-bottom: 6px;">
									Attribute Name
									<input type="text" ng-model="filter.attributeName"
										   class="form-control" style="height:20px;">
								</th>
								<th style="width:15%; vertical-align: middle;">Changed From</th>
								<th style="width:15%; vertical-align: middle;">Changed To</th>
								<th style="width:15%; vertical-align: middle;">Action Code</th>
								<th style="width:15%; vertical-align: middle;" ng-click="$ctrl.changeSort()">
									Changed On
									<span ng-if="sorting.changedOn === 'desc'" class="glyphicon glyphicon-triangle-bottom" style="top: 3px;"></span>
									<span ng-if="sorting.changedOn === 'asc'" class="glyphicon glyphicon-triangle-top" style="top: 3px;"></span>
								</th>
								<th style="width:25%; vertical-align: middle;">Changed By</th>
							</tr>
							</thead>
							<tbody>
							<tr data-ng-repeat="audit in $data track by $index">
								<td style="width:15%; padding: 5px;">{{audit.attributeName}}</td>
								<td style="width:15%">
									<div ng-if="audit.changedFrom !== 'N/A' && audit.changedFrom !== 'null'" title="{{audit.changedFrom}}" style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{audit.changedFrom}}</div>
								</td>
								<td style="width:15%">
									<div ng-if="audit.changedTo !== 'N/A' && audit.changedTo !== 'null'" title="{{audit.changedTo}}" style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{audit.changedTo}}</div>
								</td>
								<td style="width:15%">{{audit.action}}</td>
								<td style="width:15%" sortable="'changedOn'">{{audit.changedOn | date: "MM/dd/yyyy HH:mm:sss"}}</td>
								<td style="width:25%">{{audit.changedBy}}</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer ">
					<button type="button" class="btn btn-primary" ng-show="!$ctrl.isWaitingGetECommerceViewAudit && filter.attributeName !==''" ng-click="filter.attributeName=''">Clear Filter</button>
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
</div>
